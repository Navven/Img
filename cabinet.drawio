<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36 Edg/134.0.0.0" version="28.2.9">
  <diagram name="Storage System Flow" id="T3a1FpMIGG2KmHIcnLkO">
    <mxGraphModel dx="1389" dy="931" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="DKAGVm4dyFhylUpcWI94-79" value="储物柜系统业务流程（私人柜 + 便民柜）" style="text;fillColor=none;strokeColor=none;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="600" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-80" value="私人储物柜开柜流程（App/小程序）" style="text;fillColor=none;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="100" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-81" value="用户选择房屋" style="rounded=1;whiteSpace=wrap;html=1" vertex="1" parent="1">
          <mxGeometry x="100" y="150" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-82" value="绑定关系是否存在？" style="rhombus;whiteSpace=wrap;html=1" vertex="1" parent="1">
          <mxGeometry x="90" y="240" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-83" value="拒绝开柜" style="rounded=1;whiteSpace=wrap;fillColor=#ffcccc" vertex="1" parent="1">
          <mxGeometry x="350" y="250" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-84" value="校验节流（用户+格口）" style="rounded=1;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="90" y="370" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-85" value="调用 IoT 开柜" style="rounded=1;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="90" y="470" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-86" value="开柜成功" style="rounded=1;whiteSpace=wrap;fillColor=#ccffcc" vertex="1" parent="1">
          <mxGeometry x="90" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-87" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-81" target="DKAGVm4dyFhylUpcWI94-82">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-88" value="是" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-82" target="DKAGVm4dyFhylUpcWI94-84">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-89" value="否" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-82" target="DKAGVm4dyFhylUpcWI94-83">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-90" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-84" target="DKAGVm4dyFhylUpcWI94-85">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-91" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-85" target="DKAGVm4dyFhylUpcWI94-86">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-92" value="私人柜密码验证（柜子现场输入密码）" style="text;fillColor=none;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="650" y="100" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-93" value="设备请求：设备ID + 房间号 + 密码" style="rounded=1;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="650" y="150" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-94" value="绑定关系是否存在？" style="rhombus;whiteSpace=wrap;html=1" vertex="1" parent="1">
          <mxGeometry x="665" y="230" width="230" height="80" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-95" value="返回失败" style="rounded=1;whiteSpace=wrap;fillColor=#ffcccc" vertex="1" parent="1">
          <mxGeometry x="950" y="240" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-96" value="Redis 是否存在密码？" style="rhombus;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="665" y="350" width="230" height="80" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-97" value="从 DB 读取 encrypted_pwd → 写回 Redis" style="rounded=1;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="950" y="360" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-98" value="密码是否匹配？" style="rhombus;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="665" y="470" width="230" height="80" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-99" value="返回失败" style="rounded=1;whiteSpace=wrap;fillColor=#ffcccc" vertex="1" parent="1">
          <mxGeometry x="950" y="480" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-100" value="生成 session_id → 返回授权" style="rounded=1;whiteSpace=wrap;fillColor=#ccffcc" vertex="1" parent="1">
          <mxGeometry x="650" y="590" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-101" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-93" target="DKAGVm4dyFhylUpcWI94-94">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-102" value="是" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-94" target="DKAGVm4dyFhylUpcWI94-96">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-103" value="否" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-94" target="DKAGVm4dyFhylUpcWI94-95">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-104" value="是" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-96" target="DKAGVm4dyFhylUpcWI94-98">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-105" value="否" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-96" target="DKAGVm4dyFhylUpcWI94-97">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-106" value="是" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-98" target="DKAGVm4dyFhylUpcWI94-100">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-107" value="否" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-98" target="DKAGVm4dyFhylUpcWI94-99">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-108" value="便民柜借用流程" style="text;fillColor=none;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="650" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-109" value="用户点击借用" style="rounded=1;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="100" y="700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-110" value="尝试锁定格口（0→1）" style="rounded=1;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="100" y="800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-111" value="失败 → 已被他人借用" style="rounded=1;whiteSpace=wrap;fillColor=#ffcccc" vertex="1" parent="1">
          <mxGeometry x="350" y="800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-112" value="创建借用记录（status=1）" style="rounded=1;whiteSpace=wrap" vertex="1" parent="1">
          <mxGeometry x="80" y="900" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-113" value="返回 borrowId（借用成功）" style="rounded=1;whiteSpace=wrap;fillColor=#ccffcc" vertex="1" parent="1">
          <mxGeometry x="80" y="1000" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-114" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-109" target="DKAGVm4dyFhylUpcWI94-110">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-115" value="成功" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-110" target="DKAGVm4dyFhylUpcWI94-112">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-116" value="失败" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-110" target="DKAGVm4dyFhylUpcWI94-111">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DKAGVm4dyFhylUpcWI94-117" edge="1" parent="1" source="DKAGVm4dyFhylUpcWI94-112" target="DKAGVm4dyFhylUpcWI94-113">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
